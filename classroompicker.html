<!DOCTYPE html>
<html>
<head>
    <title>Mr. Lynch's Interactive Slides</title>
    <!-- We need BOTH scripts: one for the new Sign-In Button, one for the API calls -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>

    <style>
        /* (Your full CSS here) */
        body { background-color: black; color: white; font-family: sans-serif; text-align: center; }
        .main-container { display: none; /* Hidden by default */ flex-direction: row; gap: 20px; width: 95%; margin: 20px auto; text-align: left; }
        .slides-column { flex: 2; }
        .interactive-column { flex: 1; text-align: center; }
        .slide-nav { margin-top: 10px; text-align: center; }
        .slide-nav button { font-size: 16px; padding: 5px 10px; }
        .slide-nav span { margin: 0 15px; font-size: 1.2em; }
        .header { text-align: center; color: yellow; }
        #slide-loader p { font-size: 1.5em; color: #888; }
    </style>
</head>
<body>
    <h1 class="header">Mr. Lynch's Interactive Slides</h1>

    <div id="signInPrompt">
        <h2>Please sign in to view the slides.</h2>
        <!-- This is the Google Sign-In button that worked before -->
        <div id="g_id_onload"
             data-client_id="PASTE_YOUR_OAUTH_CLIENT_ID_HERE"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin"
             data-type="standard"
             data-size="large"
             data-theme="outline"
             data-text="sign_in_with"
             data-shape="rectangular"
             data-logo_alignment="left">
        </div>
    </div>
    
    <div class="main-container">
        <!-- (The rest of your HTML for slides and controls) -->
        <div class="slides-column">
            <div id="slide-loader"><p>Loading Slide...</p></div>
            <img id="slide-image" src="" alt="Current Slide" style="width:100%; border: 1px solid grey; display: none;">
            <div class="slide-nav">
                <button onclick="prevSlide()">Previous</button>
                <span id="slide-counter"></span>
                <button onclick="nextSlide()">Next</button>
            </div>
        </div>
        <div class="interactive-column">
            <p id="prompt">Enter your answer for the current slide:</p>
            <input id="inputbox" type="textbox" placeholder="Your answer here...">
            <br>
            <input id="btn" type="button" value="Check My Answer!" onclick="myfunction()">
            <p id="result"></p>
        </div>
    </div>

<script>
    // ========================================================================
    // CONFIGURATION
    // ========================================================================
    const CLIENT_ID = "1032478689007-9gk70vsn7i58l6f0qn5sr8q78sne1al5.apps.googleusercontent.com";
    const PRESENTATION_ID = "1LYl6PebqTv-KQ9aj3-lnvcZwcV_MXbn1hxVUtdG4sFo";
    const SLIDE_IDS = ["g22b68d540b9_0_0", "g11f6b98ef49_0_0", "g11f6b98ef49_0_5"];
    const SCOPES = "https://www.googleapis.com/auth/presentations.readonly";
    // ========================================================================

    let currentSlideIndex = 0;
    let tokenClient;

    // This is called automatically when the user signs in with the Google button
    function handleCredentialResponse(response) {
        // The token client (initialized below) is used to request the access token
        tokenClient.callback = (tokenResponse) => {
            if (tokenResponse && tokenResponse.access_token) {
                // This is the key step: set the token for the gapi client
                gapi.client.setToken(tokenResponse);
                
                // Now that we are fully authenticated, show the content and load slides
                document.getElementById('signInPrompt').style.display = 'none';
                document.querySelector('.main-container').style.display = 'flex';
                updateSlideDisplay();
            }
        };
        // Request the access token
        tokenClient.requestAccessToken();
    }

    function updateSlideDisplay() {
        const slideId = SLIDE_IDS[currentSlideIndex];
        const slideImageElement = document.getElementById('slide-image');
        const slideCounterElement = document.getElementById('slide-counter');

        document.getElementById('slide-loader').style.display = 'block';
        slideImageElement.style.display = 'none';

        // Use the gapi client to call the Slides API
        gapi.client.slides.presentations.pages.getThumbnail({
            presentationId: PRESENTATION_ID,
            pageObjectId: slideId
        }).then(function(response) {
            document.getElementById('slide-loader').style.display = 'none';
            slideImageElement.style.display = 'block';
            
            slideImageElement.src = response.result.contentUrl;
            slideCounterElement.innerHTML = `Slide ${currentSlideIndex + 1} of ${SLIDE_IDS.length}`;
        }, function(error) {
            console.error("API Error:", error);
            slideCounterElement.innerHTML = `Error: ${error.result.error.message || 'Could not load slide'}`;
        });
    }

    // --- Navigation and other functions ---
    function nextSlide() { if (currentSlideIndex < SLIDE_IDS.length - 1) { currentSlideIndex++; updateSlideDisplay(); } }
    function prevSlide() { if (currentSlideIndex > 0) { currentSlideIndex--; updateSlideDisplay(); } }
    function myfunction() { alert("Check Answer button clicked!"); }
    
    // This runs when the page has loaded
    window.onload = function() {
        // Initialize the token client for the OAuth2 flow
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: '', // The callback is set dynamically in handleCredentialResponse
        });
        
        // Load the gapi client library needed for API calls
        gapi.load('client', function() {
            gapi.client.load('https://slides.googleapis.com/$discovery/rest?version=v1');
        });
    }
</script>
</body>
</html>
